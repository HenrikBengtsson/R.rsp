<%
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Read and parse the inst/doc/00index.dcf of the package being built
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
pkgName <- grep("Package:", readLines("../../DESCRIPTION"), value=TRUE);
pkgName <- gsub("Package:", "", pkgName);
pkgName <- gsub("[ \t]*", "", pkgName);
pkg <- Package(pkgName);
toc <- read.dcf("00Index.dcf");
toc <- as.data.frame(toc, stringsAsFactors=FALSE);
toc$Files <- lapply(toc$Files, FUN=function(x) {
  files <- trim(unlist(strsplit(x, split=",", fixed=TRUE)));
  types <- gsub("(|(.*):).*", "\\2", files);
  exts <- gsub(".*[.]([^.]*)$", "\\1", files);
  types[nchar(types) == 0] <- exts[nchar(types) == 0];
  files <- gsub(".*:", "", files);
  names(files) <- types;
  files;
});
toc$hasPDF <- lapply(toc$Files, FUN=function(x) {
  is.element("pdf", tolower(names(x)));
});
toc$hasSource <- lapply(toc$Files, FUN=function(x) {
  any(is.element(c("html.rsp", "tex.rsp", "Rnw"), tolower(names(x))));
});

# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
# Extend
# - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
 <title><%=getName(pkg)%> User Guides</title>
 <link rel="stylesheet" type="text/css" href="../../R.css">
</head>
<body>

<h1><%=getTitle(pkg)%> <img class="toplogo" src="../../../doc/html/logo.jpg" alt="[R logo]" width="101" height="77"></h1>
<hr>

<h2>User Guides and Package Vignettes</h2>
<ul>
<% for (ii in seq(length=nrow(toc))) { %>
<%
files <- toc$Files[[ii]];
types <- names(files);

# Create a dummy Rnw for each PDF file, iff missing
if (toc$hasPDF[[ii]]) {
  filename <- files["pdf"];
  rnwFilename <- gsub("pdf$", "Rnw", filename);
  if (!isFile(rnwFilename)) {
    rspFilename <- sprintf("%s.rsp", rnwFilename);
    if (!isFile(rspFilename)) {
      pathname <- system.file("doc/templates/dummy.Rnw.rsp", package="R.rsp");
      file.copy(pathname, to=rspFilename);
    }
    local({
      hasSource <- toc$hasSource[[ii]];
      title <- toc$Title[ii];
      keywords <- toc$Keywords[ii];
      rsp(rspFilename, force=TRUE);
    });
    file.remove(rspFilename);
  }
}
%>
 <li>
 <strong><%=toc[ii,"Title"]%></strong> - <%=toc[ii,"Description"]%>
 <% for (type in types) { %>
   [<a href="<%=files[type]%>"><%=type%></a>]
 <% } %>
 </li>
<% } # for (ii ...) %>
</ul>
<br>

<hr>
<div align="center"><a href="../html/00Index.html">[Package Contents]</a></div>
<br>
<div align="center"><small>This page was generated by the <a href="http://cran.r-project.org/web/packages/R.rsp/">R.rsp</a> package.</small></div>

</body>
</html>
